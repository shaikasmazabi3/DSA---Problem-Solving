<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Sort - Beautiful Clear Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 32px;
        }

        .subtitle {
            text-align: center;
            color: #999;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-section {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
        }

        input {
            padding: 12px 18px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            min-width: 300px;
        }

        input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 10px rgba(118, 75, 162, 0.3);
        }

        button {
            padding: 12px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.processing {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        /* ==================== MAIN VISUALIZATION AREA ==================== */
        .viz-area {
            /*display: grid;*/
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .viz-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #667eea;
            display: flex;
            flex-direction: column;
        }

        .viz-panel.divide {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffe0b2 100%);
        }

        .viz-panel.merge {
            border-color: #00bcd4;
            background: linear-gradient(135deg, #e0f2f1 0%, #b2ebf2 100%);
        }

        .panel-title {
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            color: white;
        }

        .panel-title.divide {
            background: #ffc107;
            color: #333;
        }

        .panel-title.merge {
            background: #00bcd4;
        }

        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 8px;
            border: 2px dashed #ccc;
            padding: 15px;
            overflow: auto;
        }

        canvas {
            display: block;
        }

        /* ==================== ARRAYS DISPLAY ==================== */
        .arrays-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }

        .array-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #667eea;
        }

        .array-box.left {
            border-left-color: #4CAF50;
        }

        .array-box.right {
            border-left-color: #FF9800;
        }

        .array-label {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 8px;
            color: #333;
        }

        .array-label.left {
            color: #4CAF50;
        }

        .array-label.right {
            color: #FF9800;
        }

        .array-values {
            font-size: 14px;
            color: #555;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        /* ==================== INFO SECTION ==================== */
        .info-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .info-section p {
            color: #666;
            line-height: 1.6;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #d63384;
            overflow-x: auto;
            margin-top: 10px;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #333;
        }

        .step-counter {
            text-align: center;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .explanation {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            line-height: 1.6;
        }

        .explanation strong {
            color: #ff6b00;
        }

        @media (max-width: 1024px) {
            .viz-area {
                grid-template-columns: 1fr;
            }

            .arrays-display {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 24px;
            }

            input {
                min-width: 100%;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÄ Merge Sort Visualizer</h1>
        <p class="subtitle">Complete Divide & Merge Process with Clear Array Visualization</p>

        <div class="input-section">
            <input type="text" id="inputValues" placeholder="Enter values separated by commas (e.g., 3,7,2,5)" value="3,7,2,5">
            <button onclick="createList()">üìã Create List</button>
        </div>

        <div class="controls">
            <button onclick="startVisualization()" id="startBtn">‚ñ∂ Start</button>
            <button onclick="nextStep()" id="nextBtn" disabled>‚è≠ Next Step</button>
            <button onclick="prevStep()" id="prevBtn" disabled>‚èÆ Previous</button>
            <button onclick="resetViz()" id="resetBtn">üîÑ Reset</button>
        </div>

        <div id="status" class="status"></div>

        <div class="step-counter">
            Step <span id="stepNum">0</span> / <span id="totalSteps">0</span>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #667eea;"></div>
                <span>Original Node</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4CAF50;"></div>
                <span>LEFT Array</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FF9800;"></div>
                <span>RIGHT Array</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFD700;"></div>
                <span>RESULT</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: #f44336;"></div>
                <span>Slow Ptr</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: #00BCD4;"></div>
                <span>Fast Ptr</span>
            </div>
        </div>

        <!-- DIVIDE AND MERGE VISUALIZATIONS -->
        <div class="viz-area">
            <div class="viz-panel divide" id="dividePanel" style="display: none;">
                <div class="panel-title divide">‚úÇÔ∏è DIVIDE PHASE</div>
                <div class="canvas-container">
                    <canvas id="divideCanvas" width="1000" height="400"></canvas>
                </div>
            </div>

            <div class="viz-panel merge" id="mergePanel" style="display: none;">
                <div class="panel-title merge">üîó MERGE PHASE</div>
                <div class="canvas-container">
                    <canvas id="mergeCanvas" width="1000" height="550"></canvas>
                </div>
            </div>
        </div>

        <!-- CLEAR ARRAY DISPLAY -->
        <div class="arrays-display" id="arraysDisplay" style="display: none;">
            <div class="array-box left">
                <div class="array-label left">üü¢ LEFT HALF</div>
                <div class="array-values" id="leftArrayText">‚Äî</div>
            </div>
            <div class="array-box right">
                <div class="array-label right">üü† RIGHT HALF</div>
                <div class="array-values" id="rightArrayText">‚Äî</div>
            </div>
        </div>

        <!-- RESULT DISPLAY -->
        <div class="arrays-display" id="resultDisplay" style="display: none;">
            <div class="array-box" style="grid-column: 1 / -1; border-left-color: #FFD700;">
                <div class="array-label" style="color: #FFD700;">üü° RESULT ARRAY</div>
                <div class="array-values" id="resultArrayText">‚Äî</div>
            </div>
        </div>

        <!-- INFO SECTION -->
        <div class="info-section">
            <h3 id="stepTitle">Ready to Start</h3>
            <p id="stepDescription">Enter values and click "Create List" to begin</p>
            <div id="explanation" class="explanation" style="display: none;"></div>
            <div id="codeBlock" class="code-block" style="display: none;"></div>
        </div>

        <!-- POINTERS INFO -->
        <div class="info-section" id="pointersInfo" style="display: none;">
            <h3>üìç Pointers Status</h3>
            <p id="pointersDetail">‚Äî</p>
        </div>
    </div>

    <script>
        class Node {
            constructor(val) {
                this.val = val;
                this.next = null;
            }
        }

        let originalList = null;
        let steps = [];
        let currentStepIndex = 0;

        // ==================== CREATE LIST ====================
        function createList() {
            const input = document.getElementById('inputValues').value.trim();
            if (!input) {
                showStatus('Please enter values', 'processing');
                return;
            }

            const values = input.split(',').map(v => parseInt(v.trim())).filter(v => !isNaN(v));
            if (values.length === 0) {
                showStatus('Invalid input format', 'processing');
                return;
            }

            originalList = null;
            let current = null;
            for (let val of values) {
                const newNode = new Node(val);
                if (!originalList) {
                    originalList = newNode;
                    current = newNode;
                } else {
                    current.next = newNode;
                    current = newNode;
                }
            }

            steps = [];
            currentStepIndex = 0;

            document.getElementById('startBtn').disabled = false;
            document.getElementById('dividePanel').style.display = 'none';
            document.getElementById('mergePanel').style.display = 'none';
            document.getElementById('arraysDisplay').style.display = 'none';
            document.getElementById('resultDisplay').style.display = 'none';
            document.getElementById('pointersInfo').style.display = 'none';

            showStatus(`‚úì Created list: ${values.join(' ‚Üí ')}`, 'success');
        }

        // ==================== MERGE SORT ====================
        function mergeSortDetailed(head, depth = 0) {
            if (!head || !head.next) {
                return head;
            }

            // Find middle
            let slow = head;
            let fast = head;
            let prevSlow = null;

            while (fast && fast.next) {
                prevSlow = slow;
                slow = slow.next;
                fast = fast.next.next;
            }

            const allValues = getArrayFromList(head);

            // SHOW BEFORE DIVIDE
            addStep({
                type: 'before_divide',
                values: allValues,
                slow: slow,
                fast: fast,
                prevSlow: prevSlow,
                title: `Finding Middle (Depth ${depth})`,
                description: `Original list: [${allValues.join(',')}]\nFinding middle with slow-fast pointers`,
                phase: 'DIVIDE',
                depth: depth
            });

            // Split
            const secondHalf = slow;
            if (prevSlow) {
                prevSlow.next = null;
            }

            const leftValues = getArrayFromList(head);
            const rightValues = getArrayFromList(secondHalf);

            // SHOW AFTER DIVIDE
            addStep({
                type: 'after_divide',
                leftValues: leftValues,
                rightValues: rightValues,
                title: `Divided (Depth ${depth})`,
                description: `Split into two halves`,
                phase: 'DIVIDE',
                depth: depth
            });

            // Recursive calls
            const sortedLeft = mergeSortDetailed(head, depth + 1);
            const sortedRight = mergeSortDetailed(secondHalf, depth + 1);

            // Merge
            return mergeLists(sortedLeft, sortedRight, depth);
        }

        // ==================== MERGE ====================
        function mergeLists(left, right, depth) {
            const leftArray = getArrayFromList(left);
            const rightArray = getArrayFromList(right);

            addStep({
                type: 'merge_init',
                leftArray: leftArray,
                rightArray: rightArray,
                resultArray: [],
                title: `Merge Starts (Depth ${depth})`,
                description: `Merging sorted arrays`,
                phase: 'MERGE',
                depth: depth
            });

            let dummy = new Node(0);
            let current = dummy;
            let leftCopy = left;
            let rightCopy = right;
            let leftIndex = 0;
            let rightIndex = 0;
            let resultArray = [];

            while (leftCopy && rightCopy) {
                if (leftCopy.val < rightCopy.val) {
                    addStep({
                        type: 'merge_compare',
                        leftArray: leftArray,
                        rightArray: rightArray,
                        resultArray: resultArray,
                        leftIndex: leftIndex,
                        rightIndex: rightIndex,
                        title: `Compare: ${leftCopy.val} < ${rightCopy.val}? YES`,
                        description: `Taking ${leftCopy.val} from LEFT`,
                        phase: 'MERGE',
                        depth: depth,
                        action: `Connect ${leftCopy.val}`
                    });

                    current.next = leftCopy;
                    resultArray.push(leftCopy.val);
                    leftCopy = leftCopy.next;
                    leftIndex++;
                } else {
                    addStep({
                        type: 'merge_compare',
                        leftArray: leftArray,
                        rightArray: rightArray,
                        resultArray: resultArray,
                        leftIndex: leftIndex,
                        rightIndex: rightIndex,
                        title: `Compare: ${leftCopy.val} < ${rightCopy.val}? NO`,
                        description: `Taking ${rightCopy.val} from RIGHT`,
                        phase: 'MERGE',
                        depth: depth,
                        action: `Connect ${rightCopy.val}`
                    });

                    current.next = rightCopy;
                    resultArray.push(rightCopy.val);
                    rightCopy = rightCopy.next;
                    rightIndex++;
                }

                current = current.next;
            }

            while (leftCopy) {
                resultArray.push(leftCopy.val);
                current.next = leftCopy;
                leftCopy = leftCopy.next;
            }

            while (rightCopy) {
                resultArray.push(rightCopy.val);
                current.next = rightCopy;
                rightCopy = rightCopy.next;
            }

            const finalArray = getArrayFromList(dummy.next);
            addStep({
                type: 'merge_complete',
                leftArray: leftArray,
                rightArray: rightArray,
                resultArray: finalArray,
                title: `Merge Complete (Depth ${depth})`,
                description: `Result: [${finalArray.join(',')}] ‚úì SORTED`,
                phase: 'MERGE',
                depth: depth
            });

            return dummy.next;
        }

        // ==================== DRAWING ====================
        function drawStep(step) {
            const divideCanvas = document.getElementById('divideCanvas');
            const mergeCanvas = document.getElementById('mergeCanvas');
            const divideCtx = divideCanvas.getContext('2d');
            const mergeCtx = mergeCanvas.getContext('2d');

            divideCtx.clearRect(0, 0, divideCanvas.width, divideCanvas.height);
            mergeCtx.clearRect(0, 0, mergeCanvas.width, mergeCanvas.height);

            // Update arrays display
            const arraysDisplay = document.getElementById('arraysDisplay');
            const resultDisplay = document.getElementById('resultDisplay');

            if (step.phase === 'DIVIDE') {
                document.getElementById('dividePanel').style.display = 'flex';
                document.getElementById('mergePanel').style.display = 'none';
                arraysDisplay.style.display = 'grid';
                resultDisplay.style.display = 'none';

                document.getElementById('leftArrayText').textContent = step.leftValues ? `[${step.leftValues.join(', ')}]` : '‚Äî';
                document.getElementById('rightArrayText').textContent = step.rightValues ? `[${step.rightValues.join(', ')}]` : '‚Äî';

                drawDivide(divideCtx, step);
            } else if (step.phase === 'MERGE') {
                document.getElementById('dividePanel').style.display = 'none';
                document.getElementById('mergePanel').style.display = 'flex';
                arraysDisplay.style.display = 'grid';
                resultDisplay.style.display = 'grid';

                document.getElementById('leftArrayText').textContent = `[${step.leftArray.join(', ')}]`;
                document.getElementById('rightArrayText').textContent = `[${step.rightArray.join(', ')}]`;
                document.getElementById('resultArrayText').textContent = `[${step.resultArray.join(', ')}]`;

                drawMerge(mergeCtx, step);
            }
        }

        function drawDivide(ctx, step) {
            const nodeRadius = 28;
            const nodeSpacing = 90;
            const startX = 50;
            const startY = 150;

            let x = startX;
            for (let i = 0; i < step.values.length; i++) {
                const val = step.values[i];
                let color = '#667eea';

                if (step.slow && step.slow.val === val && step.values.indexOf(val) === i) {
                    color = '#f44336';
                }
                if (step.fast && step.fast.val === val) {
                    color = '#00BCD4';
                }

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, startY, nodeRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, startY, nodeRadius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 20px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(val, x, startY);

                // Arrow
                ctx.strokeStyle = '#999';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x + nodeRadius + 6, startY);
                ctx.lineTo(x + 80, startY);
                ctx.stroke();

                ctx.fillStyle = '#999';
                ctx.beginPath();
                ctx.moveTo(x + 80, startY);
                ctx.lineTo(x + 68, startY - 7);
                ctx.lineTo(x + 68, startY + 7);
                ctx.fill();

                x += nodeSpacing;
            }

            // Labels
            if (step.slow) {
                ctx.fillStyle = '#f44336';
                ctx.font = 'bold 12px Courier New';
                ctx.fillText('SLOW', startX + (step.values.indexOf(step.slow.val) * nodeSpacing), startY - 50);
            }

            if (step.fast) {
                ctx.fillStyle = '#00BCD4';
                ctx.font = 'bold 12px Courier New';
                ctx.fillText('FAST', startX + (step.values.indexOf(step.fast.val) * nodeSpacing), startY + 50);
            }
        }

        function drawMerge(ctx, step) {
            const nodeRadius = 24;
            const nodeSpacing = 65;
            const startY = 70;

            // LEFT array
            ctx.fillStyle = '#333';
            ctx.font = 'bold 13px Courier New';
            ctx.fillText('LEFT:', 20, 40);

            let x = 20;
            for (let i = 0; i < step.leftArray.length; i++) {
                const val = step.leftArray[i];
                const color = (i === step.leftIndex) ? '#FF0000' : '#4CAF50';

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, startY, nodeRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, startY, nodeRadius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(val, x, startY);

                ctx.strokeStyle = '#999';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(x + nodeRadius + 5, startY);
                ctx.lineTo(x + 55, startY);
                ctx.stroke();

                x += nodeSpacing;
            }

            // RIGHT array
            ctx.fillStyle = '#333';
            ctx.font = 'bold 13px Courier New';
            ctx.fillText('RIGHT:', 20, 160);

            x = 20;
            const rightStartY = 190;
            for (let i = 0; i < step.rightArray.length; i++) {
                const val = step.rightArray[i];
                const color = (i === step.rightIndex) ? '#FF0000' : '#FF9800';

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, rightStartY, nodeRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, rightStartY, nodeRadius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(val, x, rightStartY);

                ctx.strokeStyle = '#999';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(x + nodeRadius + 5, rightStartY);
                ctx.lineTo(x + 55, rightStartY);
                ctx.stroke();

                x += nodeSpacing;
            }

            // RESULT
            ctx.fillStyle = '#333';
            ctx.font = 'bold 13px Courier New';
            ctx.fillText('RESULT:', 20, 280);

            const resultStartY = 320;
            x = 20;
            for (let val of step.resultArray) {
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(x, resultStartY, nodeRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, resultStartY, nodeRadius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.fillStyle = 'black';
                ctx.font = 'bold 16px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(val, x, resultStartY);

                ctx.strokeStyle = '#999';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(x + nodeRadius + 5, resultStartY);
                ctx.lineTo(x + 55, resultStartY);
                ctx.stroke();

                x += nodeSpacing;
            }
        }

        // ==================== HELPERS ====================
        function getArrayFromList(head) {
            const arr = [];
            let current = head;
            while (current) {
                arr.push(current.val);
                current = current.next;
            }
            return arr;
        }

        function addStep(step) {
            steps.push(step);
        }

        function copyLinkedList(head) {
            if (!head) return null;
            const newHead = new Node(head.val);
            let current = newHead;
            let original = head.next;
            while (original) {
                current.next = new Node(original.val);
                current = current.next;
                original = original.next;
            }
            return newHead;
        }

        // ==================== CONTROL ====================
        function startVisualization() {
            if (!originalList) {
                showStatus('Create list first', 'processing');
                return;
            }

            steps = [];
            currentStepIndex = 0;

            mergeSortDetailed(copyLinkedList(originalList), 0);

            if (steps.length > 0) {
                drawStep(steps[0]);
                updateInfo(steps[0]);
                document.getElementById('startBtn').disabled = true;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('prevBtn').disabled = true;
                document.getElementById('stepNum').textContent = 1;
                document.getElementById('totalSteps').textContent = steps.length;
                showStatus(`Ready! ${steps.length} total steps`, 'processing');
            }
        }

        function nextStep() {
            if (currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                drawStep(steps[currentStepIndex]);
                updateInfo(steps[currentStepIndex]);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('stepNum').textContent = currentStepIndex + 1;

                if (currentStepIndex === steps.length - 1) {
                    showStatus('‚úì Merge sort complete!', 'success');
                    document.getElementById('nextBtn').disabled = true;
                }
            }
        }

        function prevStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                drawStep(steps[currentStepIndex]);
                updateInfo(steps[currentStepIndex]);
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('stepNum').textContent = currentStepIndex + 1;

                if (currentStepIndex === 0) {
                    document.getElementById('prevBtn').disabled = true;
                }
            }
        }

        function resetViz() {
            currentStepIndex = 0;
            steps = [];
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('dividePanel').style.display = 'none';
            document.getElementById('mergePanel').style.display = 'none';
            document.getElementById('arraysDisplay').style.display = 'none';
            document.getElementById('resultDisplay').style.display = 'none';
            document.getElementById('pointersInfo').style.display = 'none';
            showStatus('Reset', 'processing');
        }

        function updateInfo(step) {
            document.getElementById('stepTitle').textContent = step.title;
            document.getElementById('stepDescription').textContent = step.description;

            const explanation = document.getElementById('explanation');
            if (step.phase === 'DIVIDE') {
                explanation.style.display = 'block';
                explanation.innerHTML = `
                    <strong>Divide Phase (Depth ${step.depth}):</strong><br>
                    Using slow-fast pointers to find the middle node<br>
                    Slow pointer moves 1 step, Fast pointer moves 2 steps<br>
                    When fast reaches end, slow is at middle
                `;
            } else if (step.phase === 'MERGE') {
                explanation.style.display = 'block';
                if (step.type === 'merge_compare') {
                    explanation.innerHTML = `
                        <strong>Comparing:</strong> LEFT[${step.leftIndex}] = ${step.leftArray[step.leftIndex]} vs RIGHT[${step.rightIndex}] = ${step.rightArray[step.rightIndex]}<br>
                        <strong>Winner:</strong> ${step.action}<br>
                        <strong>Result so far:</strong> [${step.resultArray.join(', ')}]
                    `;
                } else {
                    explanation.innerHTML = `<strong>Merge Phase (Depth ${step.depth}):</strong><br>Comparing and merging two sorted arrays`;
                }
            }

            const pointersInfo = document.getElementById('pointersInfo');
            if (step.leftIndex !== undefined) {
                pointersInfo.style.display = 'block';
                document.getElementById('pointersDetail').innerHTML = `
                    LEFT pointer at index: <strong>${step.leftIndex}</strong> (value: ${step.leftArray[step.leftIndex] || 'done'})<br>
                    RIGHT pointer at index: <strong>${step.rightIndex}</strong> (value: ${step.rightArray[step.rightIndex] || 'done'})<br>
                    Result built: <strong>[${step.resultArray.join(', ')}]</strong>
                `;
            } else {
                pointersInfo.style.display = 'none';
            }
        }

        function showStatus(msg, type) {
            const el = document.getElementById('status');
            el.textContent = msg;
            el.className = `status show ${type}`;
        }
    </script>
</body>
</html>